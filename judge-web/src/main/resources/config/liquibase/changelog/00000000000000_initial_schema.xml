<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet author="system" id="00000000000001">
        <createTable tableName="access_log">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="access_logPK"/>
            </column>
            <column name="access_time" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="behaviour" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="handle" type="VARCHAR(255)"/>
            <column name="ip" type="VARCHAR(255)"/>
            <column name="url" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="userprofile" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000002">
        <createTable tableName="contest">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="contestPK"/>
            </column>
            <column name="begin_time" type="datetime"/>
            <column name="creation_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="disabled" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="finish_time" type="datetime"/>
            <column name="last_update_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="password" type="VARCHAR(255)"/>
            <column name="title" type="CLOB">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="creation_user" type="BIGINT"/>
            <column name="last_update_user" type="BIGINT"/>
            <column name="parent" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000003">
        <createTable tableName="contest_language">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="contest_languagePK"/>
            </column>
            <column name="contest" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="language" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000004">
        <createTable tableName="contest_problem">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="contest_problemPK"/>
            </column>
            <column name="contest_order" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="title" type="CLOB"/>
            <column name="contest" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="problem" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000005">
        <createTable tableName="contest_problem_statistics">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="contest_problem_statisticsPK"/>
            </column>
            <column name="accepted" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="solved" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="submit" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="submit_user" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="contest_problem" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000006">
        <createTable tableName="contest_userprofile_statistics">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="contest_userprofile_statisticsPK"/>
            </column>
            <column name="contest" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="userprofile" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000007">
        <createTable tableName="judge_reply">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="judge_replyPK"/>
            </column>
            <column name="committed" type="SMALLINT">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(128)"/>
            <column name="name" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="style" type="VARCHAR(32)"/>
            <column name="creation_user" type="BIGINT"/>
            <column name="last_update_user" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000008">
        <createTable tableName="language">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="languagePK"/>
            </column>
            <column name="compiler" type="VARCHAR(255)"/>
            <column name="creation_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="executable_extension" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="executor" type="VARCHAR(255)"/>
            <column name="language_extension" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(50)"/>
            <column name="creation_user" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000009">
        <createTable tableName="persistent_token">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="persistent_tokenPK"/>
            </column>
            <column name="userprofile" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000010">
        <createTable tableName="problem">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="problemPK"/>
            </column>
            <column name="case_time_limit" type="BIGINT"/>
            <column name="creation_date" type="datetime"/>
            <column name="description" type="CLOB"/>
            <column name="hint" type="CLOB"/>
            <column name="input" type="CLOB"/>
            <column name="last_update_date" type="datetime"/>
            <column name="memory_limit" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="output" type="CLOB"/>
            <column name="output_limit" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="sample_input" type="CLOB"/>
            <column name="sample_output" type="CLOB"/>
            <column name="source" type="CLOB"/>
            <column name="time_limit" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="title" type="CLOB"/>
            <column name="creation_user" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000011">
        <createTable tableName="role">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="rolePK"/>
            </column>
            <column name="description" type="CLOB">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000012">
        <createTable tableName="submission">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="submissionPK"/>
            </column>
            <column name="code_len" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="compile_info" type="CLOB"/>
            <column name="ip" type="VARCHAR(40)"/>
            <column name="judge_time" type="datetime"/>
            <column name="memory" type="BIGINT"/>
            <column name="source_code" type="CLOB"/>
            <column name="submit_time" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="time" type="BIGINT"/>
            <column name="contest" type="BIGINT"/>
            <column name="judge_reply" type="BIGINT"/>
            <column name="language" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="problem" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="userprofile" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000013">
        <createTable tableName="upload">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="uploadPK"/>
            </column>
            <column name="content" type="BLOB"/>
            <column name="content_type" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="orign_name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000014">
        <createTable tableName="usergroup">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="usergroupPK"/>
            </column>
            <column name="description" type="CLOB">
                <constraints nullable="false"/>
            </column>
            <column name="group_order" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="owner" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000015">
        <createTable tableName="usergroup_userprofile">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="usergroup_userprofilePK"/>
            </column>
            <column name="usergroup" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="userprofile" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000016">
        <createTable tableName="userprofile">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="userprofilePK"/>
            </column>
            <column name="birth_date" type="datetime"/>
            <column name="creation_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="disabled" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(255)"/>
            <column name="handle" type="VARCHAR(255)"/>
            <column name="last_update_date" type="datetime"/>
            <column name="major" type="VARCHAR(255)"/>
            <column name="nickname" type="VARCHAR(255)"/>
            <column name="password" type="VARCHAR(255)"/>
            <column name="school" type="VARCHAR(255)"/>
            <column name="creation_user" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000017">
        <createTable tableName="userprofile_role">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="userprofile_rolePK"/>
            </column>
            <column name="role" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="userprofile" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="00000000000018">
        <addUniqueConstraint columnNames="name" tableName="contest"/>
    </changeSet>
    <changeSet author="system" id="00000000000019">
        <addUniqueConstraint columnNames="contest, language" tableName="contest_language"/>
    </changeSet>
    <changeSet author="system" id="00000000000020">
        <addUniqueConstraint columnNames="contest, contest_order" tableName="contest_problem"/>
    </changeSet>
    <changeSet author="system" id="00000000000021">
        <addUniqueConstraint columnNames="contest, problem" tableName="contest_problem"/>
    </changeSet>
    <changeSet author="system" id="00000000000022">
        <addUniqueConstraint columnNames="contest_problem" tableName="contest_problem_statistics"/>
    </changeSet>
    <changeSet author="system" id="00000000000023">
        <addUniqueConstraint columnNames="contest, userprofile" tableName="contest_userprofile_statistics"/>
    </changeSet>
    <changeSet author="system" id="00000000000024">
        <addUniqueConstraint columnNames="name" tableName="role"/>
    </changeSet>
    <changeSet author="system" id="00000000000025">
        <addUniqueConstraint columnNames="owner, group_order" tableName="usergroup"/>
    </changeSet>
    <changeSet author="system" id="00000000000026">
        <addUniqueConstraint columnNames="email" tableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000027">
        <addUniqueConstraint columnNames="handle" tableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000028">
        <addUniqueConstraint columnNames="userprofile, role" tableName="userprofile_role"/>
    </changeSet>
    <changeSet author="system" id="00000000000029">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="access_log" constraintName="FK_access_log_userprofile" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000030">
        <addForeignKeyConstraint baseColumnNames="creation_user" baseTableName="contest" constraintName="FK_contest_creation_user" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000031">
        <addForeignKeyConstraint baseColumnNames="contest" baseTableName="contest_language" constraintName="FK_contest_language_contest" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="contest"/>
    </changeSet>
    <changeSet author="system" id="00000000000032">
        <addForeignKeyConstraint baseColumnNames="language" baseTableName="contest_language" constraintName="FK_contest_language_language" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="language"/>
    </changeSet>
    <changeSet author="system" id="00000000000033">
        <addForeignKeyConstraint baseColumnNames="last_update_user" baseTableName="contest" constraintName="FK_contest_last_update_user" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000034">
        <addForeignKeyConstraint baseColumnNames="parent" baseTableName="contest" constraintName="FK_contest_parent" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="contest"/>
    </changeSet>
    <changeSet author="system" id="00000000000035">
        <addForeignKeyConstraint baseColumnNames="contest" baseTableName="contest_problem" constraintName="FK_contest_problem_contest" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="contest"/>
    </changeSet>
    <changeSet author="system" id="00000000000036">
        <addForeignKeyConstraint baseColumnNames="problem" baseTableName="contest_problem" constraintName="FK_contest_problem_problem" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="problem"/>
    </changeSet>
    <changeSet author="system" id="00000000000037">
        <addForeignKeyConstraint baseColumnNames="contest_problem" baseTableName="contest_problem_statistics" constraintName="FK_contest_problem_statistics_contest_problem" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="contest_problem"/>
    </changeSet>
    <changeSet author="system" id="00000000000038">
        <addForeignKeyConstraint baseColumnNames="contest" baseTableName="contest_userprofile_statistics" constraintName="FK_contest_userprofile_statistics_contest" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="contest"/>
    </changeSet>
    <changeSet author="system" id="00000000000039">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="contest_userprofile_statistics" constraintName="FK_contest_userprofile_statistics_userprofile" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000040">
        <addForeignKeyConstraint baseColumnNames="creation_user" baseTableName="judge_reply" constraintName="FK_judge_reply_creation_user" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000041">
        <addForeignKeyConstraint baseColumnNames="last_update_user" baseTableName="judge_reply" constraintName="FK_judge_reply_last_update_user" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000042">
        <addForeignKeyConstraint baseColumnNames="creation_user" baseTableName="language" constraintName="FK_language_creation_user" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000043">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="persistent_token" constraintName="FK_persistent_token_userprofile" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000044">
        <addForeignKeyConstraint baseColumnNames="creation_user" baseTableName="problem" constraintName="FK_problem_creation_user" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000045">
        <addForeignKeyConstraint baseColumnNames="contest" baseTableName="submission" constraintName="FK_submission_contest" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="contest"/>
    </changeSet>
    <changeSet author="system" id="00000000000046">
        <addForeignKeyConstraint baseColumnNames="judge_reply" baseTableName="submission" constraintName="FK_submission_judge_reply" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="judge_reply"/>
    </changeSet>
    <changeSet author="system" id="00000000000047">
        <addForeignKeyConstraint baseColumnNames="language" baseTableName="submission" constraintName="FK_submission_language" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="language"/>
    </changeSet>
    <changeSet author="system" id="00000000000048">
        <addForeignKeyConstraint baseColumnNames="problem" baseTableName="submission" constraintName="FK_submission_problem" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="problem"/>
    </changeSet>
    <changeSet author="system" id="00000000000049">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="submission" constraintName="FK_submission_userprofile" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000050">
        <addForeignKeyConstraint baseColumnNames="owner" baseTableName="usergroup" constraintName="FK_usergroup_owner" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000051">
        <addForeignKeyConstraint baseColumnNames="usergroup" baseTableName="usergroup_userprofile" constraintName="FK_usergroup_userprofile_usergroup" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="usergroup"/>
    </changeSet>
    <changeSet author="system" id="00000000000052">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="usergroup_userprofile" constraintName="FK_usergroup_userprofile_userprofile" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000053">
        <addForeignKeyConstraint baseColumnNames="creation_user" baseTableName="userprofile" constraintName="FK_userprofile_creation_user" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="00000000000054">
        <addForeignKeyConstraint baseColumnNames="role" baseTableName="userprofile_role" constraintName="FK_userprofile_role_role" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="role"/>
    </changeSet>
    <changeSet author="system" id="00000000000055">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="userprofile_role" constraintName="FK_userprofile_role_userprofile" deferrable="false" initiallyDeferred="false" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
</databaseChangeLog>
