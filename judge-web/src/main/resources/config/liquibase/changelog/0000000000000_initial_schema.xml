<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet author="system" id="0000000000000-1">
        <createTable tableName="access_log">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="access_logPK"/>
            </column>
            <column name="access_time" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="behaviour" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="handle" type="VARCHAR(255)"/>
            <column name="ip" type="VARCHAR(255)"/>
            <column name="url" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="userprofile" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-2">
        <createTable tableName="contest">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="contestPK"/>
            </column>
            <column name="begin_time" type="datetime"/>
            <column name="creation_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="disabled" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="finish_time" type="datetime"/>
            <column name="last_update_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="password" type="VARCHAR(255)"/>
            <column name="title" type="CLOB">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="creation_user" type="BIGINT"/>
            <column name="last_update_user" type="BIGINT"/>
            <column name="parent" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-3">
        <createTable tableName="contest_language">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="contest_languagePK"/>
            </column>
            <column name="contest" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="language" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-4">
        <createTable tableName="contest_problem">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="contest_problemPK"/>
            </column>
            <column name="contest_order" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="title" type="CLOB"/>
            <column name="contest" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="problem" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-5">
        <createTable tableName="contest_problem_statistics">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="contest_problem_statisticsPK"/>
            </column>
            <column name="accepted" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="solved" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="submit" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="submit_user" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="contest_problem" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-6">
        <createTable tableName="contest_userprofile_statistics">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="contest_userprofile_statisticsPK"/>
            </column>
            <column name="contest" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="userprofile" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-7">
        <createTable tableName="judge_reply">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="judge_replyPK"/>
            </column>
            <column name="committed" type="SMALLINT">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(128)"/>
            <column name="name" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="style" type="VARCHAR(32)"/>
            <column name="creation_user" type="BIGINT"/>
            <column name="last_update_user" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-8">
        <createTable tableName="language">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="languagePK"/>
            </column>
            <column name="compiler" type="VARCHAR(255)"/>
            <column name="creation_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="executable_extension" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="executor" type="VARCHAR(255)"/>
            <column name="language_extension" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(50)"/>
            <column name="creation_user" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-9">
        <createTable tableName="limits">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="limitsPK"/>
            </column>
            <column name="memory_limit" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="output_limit" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="time_limit" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-10">
        <createTable tableName="persistent_token">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="persistent_tokenPK"/>
            </column>
            <column name="userprofile" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-11">
        <createTable tableName="problem">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="problemPK"/>
            </column>
            <column name="creation_date" type="datetime"/>
            <column name="description" type="CLOB"/>
            <column name="hint" type="CLOB"/>
            <column name="input" type="CLOB"/>
            <column name="last_update_date" type="datetime"/>
            <column name="output" type="CLOB"/>
            <column name="sample_input" type="CLOB"/>
            <column name="sample_output" type="CLOB"/>
            <column name="source" type="CLOB"/>
            <column name="title" type="CLOB"/>
            <column name="creation_user" type="BIGINT"/>
            <column name="limits" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-12">
        <createTable tableName="role">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="rolePK"/>
            </column>
            <column name="description" type="CLOB">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-13">
        <createTable tableName="submission">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="submissionPK"/>
            </column>
            <column name="code_len" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="compile_info" type="CLOB"/>
            <column name="judge_time" type="datetime"/>
            <column name="source_code" type="CLOB"/>
            <column name="submit_time" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="contest" type="BIGINT"/>
            <column name="judge_reply" type="BIGINT"/>
            <column name="language" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="problem" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="userprofile" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-14">
        <createTable tableName="upload">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="uploadPK"/>
            </column>
            <column name="content" type="BLOB"/>
            <column name="content_type" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="orign_name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-15">
        <createTable tableName="usergroup">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="usergroupPK"/>
            </column>
            <column name="description" type="CLOB">
                <constraints nullable="false"/>
            </column>
            <column name="group_order" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="owner" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-16">
        <createTable tableName="usergroup_userprofile">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="usergroup_userprofilePK"/>
            </column>
            <column name="usergroup" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="userprofile" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-17">
        <createTable tableName="userprofile">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="userprofilePK"/>
            </column>
            <column name="birth_date" type="date"/>
            <column name="creation_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="disabled" type="BOOLEAN"/>
            <column name="email" type="VARCHAR(255)"/>
            <column name="handle" type="VARCHAR(255)"/>
            <column name="last_update_date" type="datetime"/>
            <column name="major" type="VARCHAR(255)"/>
            <column name="nickname" type="VARCHAR(255)"/>
            <column name="password" type="VARCHAR(255)"/>
            <column name="school" type="VARCHAR(255)"/>
            <column name="creation_user" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-18">
        <createTable tableName="userprofile_role">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="userprofile_rolePK"/>
            </column>
            <column name="role" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="userprofile" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="system" id="0000000000000-19">
        <addUniqueConstraint columnNames="name" tableName="contest"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-20">
        <addUniqueConstraint columnNames="contest, language" tableName="contest_language"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-21">
        <addUniqueConstraint columnNames="contest, contest_order" tableName="contest_problem"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-22">
        <addUniqueConstraint columnNames="contest, problem" tableName="contest_problem"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-23">
        <addUniqueConstraint columnNames="contest_problem" tableName="contest_problem_statistics"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-24">
        <addUniqueConstraint columnNames="contest, userprofile" tableName="contest_userprofile_statistics"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-25">
        <addUniqueConstraint columnNames="name" tableName="role"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-26">
        <addUniqueConstraint columnNames="owner, group_order" tableName="usergroup"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-27">
        <addUniqueConstraint columnNames="email" tableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-28">
        <addUniqueConstraint columnNames="handle" tableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-29">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="access_log" constraintName="FK_access_log_userprofile" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-30">
        <addForeignKeyConstraint baseColumnNames="creation_user" baseTableName="contest" constraintName="FK_contest_creation_user" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-31">
        <addForeignKeyConstraint baseColumnNames="contest" baseTableName="contest_language" constraintName="FK_contest_language_contest" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="contest"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-32">
        <addForeignKeyConstraint baseColumnNames="language" baseTableName="contest_language" constraintName="FK_contest_language_language" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="language"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-33">
        <addForeignKeyConstraint baseColumnNames="last_update_user" baseTableName="contest" constraintName="FK_contest_last_update_user" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-34">
        <addForeignKeyConstraint baseColumnNames="parent" baseTableName="contest" constraintName="FK_contest_parent" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="contest"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-35">
        <addForeignKeyConstraint baseColumnNames="contest" baseTableName="contest_problem" constraintName="FK_contest_problem_contest" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="contest"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-36">
        <addForeignKeyConstraint baseColumnNames="problem" baseTableName="contest_problem" constraintName="FK_contest_problem_problem" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="problem"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-37">
        <addForeignKeyConstraint baseColumnNames="contest_problem" baseTableName="contest_problem_statistics" constraintName="FK_contest_problem_statistics_contest_problem" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="contest_problem"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-38">
        <addForeignKeyConstraint baseColumnNames="contest" baseTableName="contest_userprofile_statistics" constraintName="FK_contest_userprofile_statistics_contest" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="contest"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-39">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="contest_userprofile_statistics" constraintName="FK_contest_userprofile_statistics_userprofile" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-40">
        <addForeignKeyConstraint baseColumnNames="creation_user" baseTableName="judge_reply" constraintName="FK_judge_reply_creation_user" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-41">
        <addForeignKeyConstraint baseColumnNames="last_update_user" baseTableName="judge_reply" constraintName="FK_judge_reply_last_update_user" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-42">
        <addForeignKeyConstraint baseColumnNames="creation_user" baseTableName="language" constraintName="FK_language_creation_user" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-43">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="persistent_token" constraintName="FK_persistent_token_userprofile" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-44">
        <addForeignKeyConstraint baseColumnNames="creation_user" baseTableName="problem" constraintName="FK_problem_creation_user" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-45">
        <addForeignKeyConstraint baseColumnNames="limits" baseTableName="problem" constraintName="FK_problem_limits" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="limits"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-46">
        <addForeignKeyConstraint baseColumnNames="contest" baseTableName="submission" constraintName="FK_submission_contest" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="contest"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-47">
        <addForeignKeyConstraint baseColumnNames="judge_reply" baseTableName="submission" constraintName="FK_submission_judge_reply" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="judge_reply"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-48">
        <addForeignKeyConstraint baseColumnNames="language" baseTableName="submission" constraintName="FK_submission_language" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="language"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-49">
        <addForeignKeyConstraint baseColumnNames="problem" baseTableName="submission" constraintName="FK_submission_problem" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="problem"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-50">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="submission" constraintName="FK_submission_userprofile" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-51">
        <addForeignKeyConstraint baseColumnNames="owner" baseTableName="usergroup" constraintName="FK_usergroup_owner" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-52">
        <addForeignKeyConstraint baseColumnNames="usergroup" baseTableName="usergroup_userprofile" constraintName="FK_usergroup_userprofile_usergroup" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="usergroup"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-53">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="usergroup_userprofile" constraintName="FK_usergroup_userprofile_userprofile" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-54">
        <addForeignKeyConstraint baseColumnNames="creation_user" baseTableName="userprofile" constraintName="FK_userprofile_creation_user" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-55">
        <addForeignKeyConstraint baseColumnNames="role" baseTableName="userprofile_role" constraintName="FK_userprofile_role_role" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="role"/>
    </changeSet>
    <changeSet author="system" id="0000000000000-56">
        <addForeignKeyConstraint baseColumnNames="userprofile" baseTableName="userprofile_role" constraintName="FK_userprofile_role_userprofile" deferrable="false" initiallyDeferred="false" referencedColumnNames="id" referencedTableName="userprofile"/>
    </changeSet>
</databaseChangeLog>
